{% extends 'home.html' %} 

{% block title %}Reserva{% endblock %} 

{% block content %} 
{% load static %}

<link rel="stylesheet" href="{% static 'css/reserva-glass.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">

<div class="reserva-container">
    <header class="reserva-header">
        <img src="{% static 'img/logo_blanco.png' %}" alt="Gise-Nails" class="logo">
        <div class="marca-texto">
            <h2 >Reserva tu cita online</h2>
        </div>
    </header>

    <main class="main-content">
        <section class="form-section">
            <p class="instrucciones" >
                Completa tus datos, elige categoría y servicio, selecciona fecha y hora, y confirma tu cita. ¡Fácil y rápido!
            </p>
            <form method="post" action="" class="reserva-form" novalidate>
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-6">
                        <label for="nombre">Nombre</label>
                        <input id="nombre" type="text" name="nombre" placeholder="Ej. Ana Pérez" required>
                    </div>
                    <div class="col-md-6">
                        <label for="telefono">Teléfono</label>
                        <input id="telefono" type="tel" name="telefono" placeholder="300 000 0000" required>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="correo">Correo</label>
                        <input id="correo" type="email" name="correo" placeholder="tu@correo.com">
                    </div>
                    <div class="col-md-6">
                        <label for="gestora-select">Gestora</label>
                        <select name="gestora" id="gestora-select" required>
                            <option value="">Selecciona gestora</option>
                            {% for gestora in gestoras %}
                                <option value="{{ gestora.id }}">{{ gestora.nombre }} {{ gestora.apellidos }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="tipo-servicio">Categoría de servicio</label>
                        <select name="tipo_servicio" id="tipo-servicio" required>
                            <option value="">Selecciona categoría</option>
                            <option value="manicure">Manicure</option>
                            <option value="pedicure">Pedicure</option>
                            <option value="estructura">Estructura de uñas</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="fecha-select">Fecha</label>
                        <input id="fecha-select" type="text" name="fecha" required placeholder="DD/MM/AAAA">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <label for="horario-select">Horario</label>
                        <select name="hora" id="horario-select" required>
                            <option value="">Selecciona horario</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <input type="hidden" name="servicio" id="servicio-input" value="{{ request.GET.servicio|default:'' }}">
                        <div id="resumen-servicio" class="selected-summary" aria-live="polite" hidden>
                            <img id="resumen-img" src="" alt="" />
                            <div class="meta">
                                <strong id="resumen-nombre">Sin servicio</strong>
                                <div class="precio" id="resumen-precio"></div>
                                <div class="categoria" id="resumen-categoria"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div id="servicios-contenedor" class="servicios-list" role="list"></div> -->

                <div id="modal-servicios" class="modal-servicios" aria-hidden="true" role="dialog" aria-modal="true">
                  <div class="modal-panel" role="document">
                      <div class="modal-header">
                        <h3 id="modal-title">Servicios</h3>
                        <button id="modal-close" class="modal-close" aria-label="Cerrar"></button>
                      </div>
                      <div class="modal-body">
                        <div id="modal-servicios-list" class="modal-servicios-list"></div>
                      </div>
                        <div class="modal-footer">
                            <button id="modal-cancel" class="modal-btn cancelar"><span class="icon">&#10006;</span>Cancelar</button>
                        </div>
                    </div>
                  </div>
                    <div id="validation-modal" class="modal-validation" aria-hidden="true" role="alertdialog" aria-modal="true">
                        <div class="modal-panel validation-panel" role="document">
                                <div class="validation-body">
                                    <div class="validation-icon" aria-hidden="true">⚠️</div>
                                    <div class="validation-message" id="validation-message">Mensaje</div>
                                </div>
                                <div class="modal-footer">
                                        <button id="validation-ok" type="button" class="modal-btn confirmar">Aceptar</button>
                                </div>
                        </div>
                    </div>
                    <div id="warning-modal" class="modal-validation" aria-hidden="true" role="alertdialog" aria-modal="true">
                    <div class="modal-panel validation-panel" role="document">
                    <div class="validation-body">
            <div class="validation-icon" aria-hidden="true">⚠️</div>
            <div class="validation-message" id="warning-message">Por favor selecciona un servicio para continuar con tu reserva.</div>
        </div>
        <div class="modal-footer">
            <button id="warning-ok" type="button" class="modal-btn confirmar">Aceptar</button>
        </div>
    </div>
</div>

                <div class="acciones">
                    <button type="submit" class="modal-btn confirmar"><span class="icon">&#10004;</span>Confirmar cita</button>
                </div>
            </form>
        </section>
    </main>
</div>

<script id="servicios-data" type="application/json">
    {
        "manicure": [
            {% for s in servicios_por_categoria.manicure %}
                {
                    "id": "{{ s.id }}",
                    "nombre": "{{ s.nombre|escapejs }}",
                    "precio": "{{ s.precio }}",
                    "imagen": "{{ s.imagen.url }}"
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ],
        "pedicure": [
            {% for s in servicios_por_categoria.pedicure %}
                {
                    "id": "{{ s.id }}",
                    "nombre": "{{ s.nombre|escapejs }}",
                    "precio": "{{ s.precio }}",
                    "imagen": "{{ s.imagen.url }}"
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ],
        "estructura": [
            {% for s in servicios_por_categoria.estructura %}
                {
                    "id": "{{ s.id }}",
                    "nombre": "{{ s.nombre|escapejs }}",
                    "precio": "{{ s.precio }}",
                    "imagen": "{{ s.imagen.url }}"
                }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]
    }
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
<script src="{% static 'js/servicios.js' %}"></script>
<script src="{% static 'js/reserva2.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    flatpickr("#fecha-select", {
      dateFormat: "d/m/Y",
      minDate: "today",
      locale: "es"
    });
  });
</script>
{% endblock %}